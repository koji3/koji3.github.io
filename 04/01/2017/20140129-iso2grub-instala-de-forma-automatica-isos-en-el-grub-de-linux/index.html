<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  <title>Jose-Linares.com</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="title: iso2grub: Instala de forma automática isos en el grub de Linuxlink: http://jose-linares.com/iso2grub-instala-de-forma-automatica-isos-en-el-grub-de-linux/author: koji3description:post_id: 764cr">
<meta property="og:type" content="article">
<meta property="og:title" content="Jose-Linares.com">
<meta property="og:url" content="http://jose-linares.com/04/01/2017/20140129-iso2grub-instala-de-forma-automatica-isos-en-el-grub-de-linux/index.html">
<meta property="og:site_name" content="Jose-Linares.com">
<meta property="og:description" content="title: iso2grub: Instala de forma automática isos en el grub de Linuxlink: http://jose-linares.com/iso2grub-instala-de-forma-automatica-isos-en-el-grub-de-linux/author: koji3description:post_id: 764cr">
<meta property="og:updated_time" content="2017-01-04T10:54:02.476Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jose-Linares.com">
<meta name="twitter:description" content="title: iso2grub: Instala de forma automática isos en el grub de Linuxlink: http://jose-linares.com/iso2grub-instala-de-forma-automatica-isos-en-el-grub-de-linux/author: koji3description:post_id: 764cr">
  
    <link rel="alternate" href="/atom.xml" title="Jose-Linares.com" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/typing.css">
</head>

  
    <body>
  
      <div id="container" class="container">
        <article id="post-20140129-iso2grub-instala-de-forma-automatica-isos-en-el-grub-de-linux" class="article article-type-post" itemscope itemprop="blogPost">
  <header id="header" class="header">
  <nav id="main-nav" class="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    
      <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
    
  </nav>
</header>

  <hr/>
  <div class="article-inner">
    
    
    <div class="article-entry typo" itemprop="articleBody">
      
        <p>title: iso2grub: Instala de forma automática isos en el grub de Linux<br>link: <a href="http://jose-linares.com/iso2grub-instala-de-forma-automatica-isos-en-el-grub-de-linux/">http://jose-linares.com/iso2grub-instala-de-forma-automatica-isos-en-el-grub-de-linux/</a><br>author: koji3<br>description:<br>post_id: 764<br>created: 2014/01/29 10:38:08<br>created_gmt: 2014/01/29 10:38:08<br>comment_status: open<br>post_name: iso2grub-instala-de-forma-automatica-isos-en-el-grub-de-linux<br>status: publish<br>post_type: post</p>
<h1 id="iso2grub-Instala-de-forma-automatica-isos-en-el-grub-de-Linux"><a href="#iso2grub-Instala-de-forma-automatica-isos-en-el-grub-de-Linux" class="headerlink" title="iso2grub: Instala de forma automática isos en el grub de Linux"></a>iso2grub: Instala de forma automática isos en el grub de Linux</h1><p><strong>Actualización</strong> al final del post Si estáis tan hartos como yo de querer probar 1000 distribuciones y no hacerlo por la pereza que da pasarlas a un pen booteable (primero hay que encontrar uno), quemarlas a un disco o peor aun, instalarlas en su propia partición. Pero hoy traigo la solución, un script de fabricación propia que recibe por parámetro un archivo iso y le agrega una entrada en el grub. Al reiniciar, si seleccionas esa entrada, cargará la iso y podrás utilizar el sistema de una forma más fluida que si lo leyera de un DVD. Pide permisos de root, pues son necesarios para modificar el archivo de configuración de grub. Si no os fiáis, mirad el código ;P Su uso es: </p>
<pre><code>iso2grub.sh archivo.iso md5_opcional
</code></pre><p>También necesitáis saber la ubicación de dos archivos: vmlinuz y initrd. Este último suele tener extensión .lz, .gz o .xz . Para averiguar esta información tenéis que abrir la iso con el gestor de archivadores (o montarla en vuestro sistema) y navegar por los directorios hasta encontrarlos. Una vez los encontráis, le pasáis al programa la ruta relativa al punto de montaje. Por ejemplo: Si montáis la imagen en /usr/iso y el archivo vmlinuz se encuentra en la carpeta boot, solo tenéis que escribir /boot/vmlinuz, no /usr/iso/boot/vmlinuz. Si tenéis dificultades con esto comentadlo en el post y os ayudo (tengo que automatizar la búsqueda de estos archivos, pero no tengo tiempo) </p>
<pre><code>#!/bin/bash

#Instala una nueva entrada en el menú de grub2 para
#la imagen que se pasa como parámetro, el md5 es opcional

#Distribuido con la mejor intención pero sin ninguna garantía
#Tranquilos, no maneja archivos importantes, nunca dejará el sistema inutilizado
#Pero es posible que no funcione con todas las distros
#By: http://jose-linares.com

#Comprueba la cantidad de parámetros
if [[ $# &lt; 1 ]] ; then 
echo &quot;Número de argumentos incorrecto. Uso: $0 archivo.iso [md5]&quot; &gt;&amp;2
exit 1
fi

#Comprueba si se tienen permisos de root
if [[ $(whoami) != &apos;root&apos; ]] ; then 
echo &quot;Permisos insuficientes. Ejecutar como root&quot; &gt;&amp;2
exit 1
fi

#Comprueba la integridad de los datos 
if [[ $# == 2 ]] ; then 
echo &quot;Comprobando suma de verificación...&quot;
mdcinco=$(md5sum $1 | cut -d &quot; &quot; -f1)
if [[ &quot;$mdcinco&quot; != &quot;$2&quot; ]] ; then
echo &quot;Suma de comprobación incorrecta. Imagen corrupta o md5sum no instalado&quot; &gt;&amp;2
echo &quot;Proporcionado $2&quot; &gt;&amp;2
echo &quot;Calculado $mdcinco&quot; &gt;&amp;2
exit 1
fi
echo -e &quot;Suma de comprobación correcta \033[0;32m \xE2\x9c\x93&quot;
fi

#Comprueba si existe el archivo de configuración de grub2 necesario
if [[ ! -w &apos;/etc/grub.d/40_custom&apos; ]] ; then
echo &quot;Archivo de configuración no encontrado. Grub instalado?&quot; &gt;&amp;2
error
fi

#Mendigando un reporte de error
function error
{
echo -e &quot;Iso no soportada, por favor deja un comentario en esta entrada:\nhttp://jose-linares.com/iso2grub-instala-de-forma-automatica-isos-en-el-grub-de-linux \ncon el nombre del sistema que intentabas montar (y la versión) y el error que te ha dado. Gracias! :D&quot;
exit 1
}

#Detecta el dispositivo donde se encuentra el iso y el punto de montaje, así como otros datos necesarios
ruta_absoluta=$(readlink -f $1)
p_montaje=$(df $1 --output=target | tail -n1)
dispositivo=$(df $1 --output=source | tail -n1)

letra_disco=$(echo $dispositivo | cut -b 8)
case $letra_disco in
a) num_disco=0;;
b) num_disco=1;;
c) num_disco=2;;
d) num_disco=3;;
e) num_disco=4;;
*) exit 1;;
esac

particion=$(echo $dispositivo | cut -b 9-)
iso_scan=${ruta_absoluta##$p_montaje}

#TODO: buscar archivos automáticamente
read -p &quot;Dentro de la iso, donde se encuentra el archivo vmlinuz? (busca en /boot o /casper)&quot; vmlinuz
read -p &quot;Dentro de la iso, donde se encuentra el archivo initrd? (extension: .xz , .gz o .lz normalmente)&quot; initrd
read -p &quot;Titulo que se mostrará en el Grub?&quot; titulo

#Escribe la información de la nueva entrada en el archivo 40_custom
echo &quot;menuentry \&quot;$titulo\&quot; {
set root=(hd$num_disco,$particion)
loopback loop $iso_scan
linux (loop)$vmlinuz boot=casper iso-scan/filename=$iso_scan --
initrd (loop)$initrd
}&quot; &gt;&gt; /etc/grub.d/40_custom

#Actualiza grub
update-grub &gt; /dev/null 2&gt; /dev/null
if [[ $? -ne 0 ]]; then 
grub2-mkconfig -o /boot/grub2/grub.cfg &gt; /dev/null 2&gt; /dev/null
if [[ $? -eq 0 ]]; then echo -e &quot;Correcto, prueba a reiniciar \033[0;32m \xE2\x9c\x93&quot; ; else echo &quot;Error en update-grub o grub2-mkconfig&quot; &gt;&amp;2 ; error; fi
else
echo -e &quot;Correcto, prueba a reiniciar \033[0;32m \xE2\x9c\x93&quot; 
fi
</code></pre><p>Podéis descargarlo de aquí: <a href="http://jose-linares.com/iso2grub.sh">http://jose-linares.com/iso2grub.sh</a> Cabe destacar que esto solo funciona si la imagen está preparada para funcionar en live (Al igual que cuando instalas en un USB) y que si movéis la imagen de sitio, dejará de funcionar. Comentar nunca está mal visto ;) EDITO: parece que es más difícil adecuar el script a cada distribución, pues cada una se estructura de una manera y ahora, de exámenes no tengo tiempo de verlo. De todos modos lo dejo aquí para que quien quiera lo mejore o lo utilice. Por ahora lo he probado con wifislax 4.8-RC1 y con easypeasy y funciona.</p>
<h2 id="Comments"><a href="#Comments" class="headerlink" title="Comments"></a>Comments</h2><p><strong><a href="#448" title="2016-03-10 20:29:05">Juangmuriel</a>:</strong> Es una idea muy buena para los aficcinados al distrohopping.</p>

      
    </div>
    <footer class="article-footer">
      <ul class="article-meta">
        <li>
          <span class="label">Published Date:</span>
          <a href="/04/01/2017/20140129-iso2grub-instala-de-forma-automatica-isos-en-el-grub-de-linux/" class="article-date">
  <time datetime="2017-01-04T22:42:00.659Z" itemprop="datePublished">04/01/2017</time>
</a>

        </li>
        
        
        <hr/>
      </ul>
    </footer>
  </div>
  
    
<nav id="article-nav" class="article-nav">
  
    <a href="/04/01/2017/20140129-jugando-a-ser-hacker-capitulo-1/" id="article-nav-newer" class="article-nav-link-wrap newer">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/04/01/2017/20140127-bash-scripting-comando-test-expresiones/" id="article-nav-older" class="article-nav-link-wrap older">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>


  
</article>




      </div>
      
    <footer id="footer" class="post-footer footer">
      <hr/>
      <div id="footerContent" class="footer-content">
        <p>2017 @ Any Rights Reserved</p>


      </div>
    </footer>

      

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/typing.js"></script>
<!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->







    </div>
  </body>
</html>
